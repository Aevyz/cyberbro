<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flag-icons/6.6.6/css/flag-icons.min.css">
    <title>Cyberbro</title>
    <style>
        :root {
            --primary-color: #007bff;
            --primary-hover-color: #0056b3;
            --background-color: #f8f9fa;
            --text-color: #343a40;
            --border-color: #ced4da;
            --border-radius: 5px;
            --dark-background-color: #1e2a36;
            --dark-text-color: #d1d1d1;
            --dark-border-color: #3a4b5a;
            --dark-primary-color: #3a4b5a;
            --dark-primary-hover-color: #4b5c6d;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
        }

        .container {
            width: 80%;
            margin: 0 auto;
            padding: 20px;
        }

        .container input[type="checkbox"] {
            accent-color: var(--primary-color);
        }

        textarea {
            width: 100%;
            height: 100px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 10px;
            font-size: 1rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            margin-bottom: 20px;
        }

        th,
        td {
            padding: 15px;
            border: 1px solid var(--border-color);
            text-align: left;
        }

        th {
            background-color: #e9ecef;
        }

        .btn {
            padding: 10px 20px;
            margin: 10px 0;
            cursor: pointer;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: background-color 0.3s;
        }

        .btn:hover {
            background-color: var(--primary-hover-color);
        }

        .btn-small {
            padding: 5px 10px;
            font-size: 0.875rem;
        }

        .radio-container {
            background: #fff;
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
            display: inline-block;
            padding: 5px;
            font-size: 0.875rem;
            color: var(--text-color);
        }

        .radio-container label {
            
            border: 1px solid transparent;
            border-radius: var(--border-radius);
            display: inline-block;
            height: 26px;
            line-height: 26px;
            margin: 0;
            padding: 0;
            text-align: center;
            transition: .2s all ease-in-out;
            width: 100px;
    }

        .radio-container input[type="radio"] {
            display: none;
        }

        .radio-container label:hover {
            background: var(--primary-hover-color);
            color: white;
        }

        .radio-container input[type="radio"]:checked + label:hover {
            background: var(--primary-hover-color);
            color: white;
        }

        .radio-container input[type="radio"]:checked + label {
            background: var(--primary-color);
            color: white;
        }

        

        .high-risk {
            background-color: #dc3545;
            color: black;
        }

        .high-detection {
            background-color: #dc3545;
            color: black;
        }

        .clean-detection {
            background-color: #28a745;
            color: black;
        }

        .warning-row {
            background-color: #ffc107;
            color: black;
        }

        .filter-input,
        .filter-select {
            padding: 10px;
            margin: 10px 0;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            width: calc(100% - 22px);
            font-size: 1rem;
        }

        .filter-input:focus,
        .filter-select:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        .filters-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .filters-container .filter-input,
        .filters-container .filter-select,
        .filters-container .btn {
            flex: 1;
            min-width: 150px;
        }

        tr:hover {
            background-color: #f1f1f1;
            color: black;
        }

        body.dark-mode {
            background-color: var(--dark-background-color);
            color: var(--dark-text-color);
        }

        body.dark-mode th {
            background-color: #2b3a47;
        }

        body.dark-mode td,
        body.dark-mode th {
            border-color: var(--dark-border-color);
        }

        body.dark-mode .filter-input,
        body.dark-mode .filter-select {
            background-color: #2b3a47;
            color: var(--dark-text-color);
            border-color: var(--dark-border-color);
        }

        body.dark-mode .filter-input:focus,
        body.dark-mode .filter-select:focus {
            border-color: var(--dark-primary-hover-color);
        }

        .dark-mode-toggle {
            position: fixed;
            top: 10px;
            right: 10px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s;
        }

        .dark-mode-toggle:hover {
            background-color: var(--primary-hover-color);
        }

        body.dark-mode tr:hover {
            background-color: #2b3a47;
            color: var(--dark-text-color);
        }

        .github-logo-light {
            display: block;
        }

        .github-logo-dark {
            display: none;
        }

        body.dark-mode .github-logo-light {
            display: none;
        }

        body.dark-mode .github-logo-dark {
            display: block;
        }

        a {
        color: var(--primary-color);
        text-decoration: none;
        transition: color 0.3s;
    }

    a:hover {
        color: var(--primary-hover-color);
    }
    .footer {
        position: fixed;
        bottom: 0;
        width: 100%;
        background-color: var(--primary-color);
        color: white;
        text-align: center;
        padding: 10px 0;
    }

    .footer nav ul {
        list-style: none;
        padding: 0;
        margin: 0;
        display: flex;
        justify-content: center;
        gap: 20px;
    }

    .footer nav ul li {
        display: inline;
    }

    .footer nav ul li a {
        color: white;
        text-decoration: none;
        font-size: 1rem;
    }

    .footer nav ul li a:hover {
        color: var(--primary-hover-color);
    }
    </style>
</head>

<body>
    <div class="container">
        <button class="dark-mode-toggle" onclick="toggleDarkMode()">
            <img id="darkModeIcon" src="https://img.icons8.com/ios-filled/50/ffffff/moon-symbol.png" alt="Dark Mode" width="20" height="20">
        </button>

        <a href="https://github.com/stanfrbd/cyberbro" target="_blank" class="github-logo">
            <img src="https://upload.wikimedia.org/wikipedia/commons/9/91/Octicons-mark-github.svg" alt="GitHub Logo" width="40" height="40" class="github-logo-light">
            <img src="https://upload.wikimedia.org/wikipedia/commons/9/91/Octicons-mark-github.svg" alt="GitHub Logo" width="40" height="40" class="github-logo-dark" style="filter: invert(1);">
        </a>
        <div id="startForm">
            <h1>Cyberbro - Observable Analysis</h1>

            <form id="analyzeForm" method="POST" action="/analyze">
                <label for="observables">Paste your observables here</label><br><br>
                <textarea name="observables" placeholder="1.2.3.4
example.com
d41d8cd98f00b204e9800998ecf8427e
Or just IoC (plain text, separated, html, json, csv, log data, garbage data, fanged data [.] [dot] hxxp, etc.)" required></textarea>
                <br>

                <div>
                    <h3 title="Use your mouse to hover over the engine name to see what it does">Select the engines to use</h3>
                </div>
                <div>
                    <label title="Performs a reverse DNS lookup for IP, domain, URL (on your machine)"><input type="checkbox" name="engines" value="reverse_dns" data-supports="default domain ip abuse free_no_key" checked> Reverse DNS </label><br>
                    <label title="Checks RDAP (ex Whois) record for domain, URL, no API key required"><input type="checkbox" name="engines" value="rdap" data-supports="default abuse domain free_no_key" checked> RDAP (ex Whois)</label><br>
                    <label title="Checks IPquery for IP, reversed obtained IP for a given domain / URL, free, no API key"><input type="checkbox" name="engines" value="ipquery" data-supports="default ip risk vpn proxy free_no_key" checked> IPquery</label><br>
                    <label title="Checks AbuseIPDB for IP, reversed obtained IP for a given domain / URL, free API key required"><input type="checkbox" name="engines" value="abuseipdb" data-supports="risk"> AbuseIPDB</label><br>
                    <label title="Checks IPinfo for IP, reversed obtained IP for a given domain / URL, free API key required"><input type="checkbox" name="engines" value="ipinfo" data-supports="ip"> IPinfo</label><br>
                    <label title="Checks IP Quality Score for IP, reversed obtained IP for a given domain / URL, free API key required"><input type="checkbox" name="engines" value="ip_quality_score" data-supports="vpn proxy risk"> IP Quality Score</label><br>
                    <label title="Checks VirusTotal for IP, domain, URL, hash, free API key required"><input type="checkbox" name="engines" value="virustotal" data-supports="hash risk ip domain url"> VirusTotal</label><br>
                    <label title="Scraps Spur.us for IP, reversed obtained IP for a given domain / URL, free, no API key"><input type="checkbox" name="engines" value="spur" data-supports="vpn proxy free_no_key scraping"> Spur.us</label><br>
                    <label title="Checks Microsoft Defender for Endpoint, paid API info on Azure required"><input type="checkbox" name="engines" value="mde" data-supports="hash ip domain url"> Microsoft Defender for Endpoint</label><br>
                    <label title="Checks Google Safe Browsing, free API key required"><input type="checkbox" name="engines" value="google_safe_browsing" data-supports="risk domain ip"> Google Safe Browsing</label><br>
                    <label title="Checks Shodan, reversed obtained IP for a given domain / URL, free API key required"><input type="checkbox" name="engines" value="shodan" data-supports="ports ip"> Shodan</label><br>
                    <label title="Checks Phishtank for domains, URL, free, no API key"><input type="checkbox" name="engines" value="phishtank" data-supports="risk domain url free_no_key"> Phishtank</label><br>
                    <label title="Checks ThreatFox by Abuse.ch for IP, domains, URL, free, no API key"><input type="checkbox" name="engines" value="threatfox" data-supports="ip domain url free_no_key"> ThreatFox</label><br>
                    <label title="Scraps Google search results for all types of observable, free, no API key"><input type="checkbox" name="engines" value="google" data-supports="domain url ip hash free_no_key scraping"> Google</label><br>
                    <label title="Scraps Github search results for all types of observable, free, no API key"><input type="checkbox" name="engines" value="github" data-supports="domain url ip hash free_no_key scraping"> Github</label><br>
                    <label title="Scraps (can be long) Ioc.One HTML search results for all types of observable, free, no API key"><input type="checkbox" name="engines" value="ioc_one_html" data-supports="domain url ip hash scraping"> Ioc.One (HTML)</label><br>
                    <label title="Scraps (can be long) Ioc.One PDF search results for all types of observable, free, no API key"><input type="checkbox" name="engines" value="ioc_one_pdf" data-supports="domain url ip hash scraping"> Ioc.One (PDF)</label><br>
                    <label title="Checks abuse contact with Abusix for IP, reversed obtained IP for a given domain / URL, free, no API key"><input type="checkbox" name="engines" value="abusix" data-supports="abuse free_no_key"> Abusix</label><br><br>
                </div>

                <div>
                    <div class="radio-container">
                        <input type="radio" id="selectAll" name="engineSelection">
                        <label title="Can be long" for="selectAll" onclick="selectAllEngines()">All</label>
                        <input type="radio" id="selectAbuseChecker" name="engineSelection">
                        <label title="Only IP, domain, URL - All free, no key" for="selectAbuseChecker" onclick="selectAbuseChecker()">Abuse mail</label>
                        <input type="radio" id="selectHash" name="engineSelection">
                        <label for="selectHash" onclick="selectHash()">Hash</label>
                        <input type="radio" id="selectVpn" name="engineSelection">
                        <label title="Only IP" for="selectVpn" onclick="selectVpn()">VPN / Proxy</label>
                        <input type="radio" id="selectFree" name="engineSelection">
                        <label title="All free engines, no key" for="selectFree" onclick="selectFree()">Free</label>
                        <input type="radio" id="selectDefault" name="engineSelection" checked>
                        <label title="Good for IP / domain / URL basic info" for="selectDefault" onclick="selectDefault()">Default</label>
                    </div>
                </div>
                <br>

                <script>
                    function selectAllEngines() {
                        document.querySelectorAll('input[name="engines"]').forEach(checkbox => checkbox.checked = true);
                    }

                    function selectAbuseChecker() {
                        document.querySelectorAll('input[name="engines"]').forEach(checkbox => {
                            checkbox.checked = checkbox.dataset.supports.includes('abuse');
                        });
                    }

                    function selectHash() {
                        document.querySelectorAll('input[name="engines"]').forEach(checkbox => {
                            checkbox.checked = checkbox.dataset.supports.includes('hash');
                        });
                    }

                    function selectVpn() {
                        document.querySelectorAll('input[name="engines"]').forEach(checkbox => {
                            checkbox.checked = checkbox.dataset.supports.includes('vpn');
                        });
                    }

                    function selectDefault() {
                        document.querySelectorAll('input[name="engines"]').forEach(checkbox => {
                            checkbox.checked = checkbox.dataset.supports.includes('default');
                        });
                    }

                    function selectFree() {
                        document.querySelectorAll('input[name="engines"]').forEach(checkbox => {
                            checkbox.checked = checkbox.dataset.supports.includes('free_no_key');
                        });
                    }
                </script>

                <button type="submit" class="btn">Start Analysis</button>
            </form>
        </div>

        {% if analysis_results %}
        <script>
            function hideForm() {
                document.getElementById("startForm").style.display = "none";
            }
            hideForm();
        </script>

        <h1>Cyberbro - Analysis Results</h1>

        <button class="btn" onclick="location.href='/'">New Analysis</button>
        <form method="GET" action="/export/{{ analysis_results.id }}">
            <button type="submit" name="format" value="csv" class="btn">Export to CSV</button>
            <button type="submit" name="format" value="excel" class="btn">Export to Excel</button>
        </form>

        <p>Analysis start time: {{ analysis_results.start_time_string }}</p>
        <p>Analysis duration: {{ analysis_results.analysis_duration_string }}</p>

        <div class="filters-container">
            <input type="text" id="searchInput" class="filter-input" onkeyup="filterTable()" placeholder="Search...">

            <select id="typeFilter" class="filter-select" onchange="filterTable()">
                <option value="all">All observables types</option>
                {% set types = [] %}
                {% for result in analysis_results.results %}
                {% if result.type not in types %}
                {% set _ = types.append(result.type) %}
                <option value="{{ result.type }}">{{ result.type }}</option>
                {% endif %}
                {% endfor %}
            </select>

            <select id="countryFilter" class="filter-select" onchange="filterTable()">
                <option value="all">All Countries</option>
                {% set countries = [] %}
                {% for result in analysis_results.results %}
                {% if (result.ipinfo and result.ipinfo.country_name not in countries) or (result.ipquery and result.ipquery.country_name not in countries) %}
                {% if result.ipinfo and result.ipinfo.country_name not in countries %}
                {% set _ = countries.append(result.ipinfo.country_name) %}
                <option value="{{ result.ipinfo.country_name | lower }}">{{ result.ipinfo.country_name }}</option>
                {% endif %}
                {% if result.ipquery and result.ipquery.country_name not in countries %}
                {% set _ = countries.append(result.ipquery.country_name) %}
                <option value="{{ result.ipquery.country_name | lower }}">{{ result.ipquery.country_name }}</option>
                {% endif %}
                {% endif %}
                {% endfor %}
            </select>

            <select id="riskFilter" class="filter-select" onchange="filterTable()">
                <option value="all">All Risks</option>
                <option value="high">High Risk</option>
                <option value="low">Low Risk</option>
            </select>

            <select id="detectionFilter" class="filter-select" onchange="filterTable()">
                <option value="all">All Detections</option>
                <option value="high">High Detection</option>
                <option value="clean">Clean Detection</option>
            </select>

            <select id="proxyVpnFilter" class="filter-select" onchange="filterTable()">
                <option value="all">All connection info</option>
                <option value="proxy">Proxy</option>
                <option value="vpn">VPN</option>
                <option value="not anonymous">Not anonymous</option>
            </select>

            <button class="btn" onclick="clearFilters()">Clear Filters</button>
        </div>

        <table id="resultsTable">
            <thead>
                <tr>
                    <th>Observable</th>
                    <th>Type</th>
                    {% if "reverse_dns" in analysis_results.selected_engines %}
                    <th>DNS Lookup</th>
                    {% endif %}
                    {% if "ipquery" in analysis_results.selected_engines %}
                    <th>IPquery</th>
                    {% endif %}
                    {% if "ipinfo" in analysis_results.selected_engines %}
                    <th>IPinfo</th>
                    {% endif %}
                    {% if "abuseipdb" in analysis_results.selected_engines %}
                    <th>AbuseIPDB</th>
                    {% endif %}
                    {% if "ip_quality_score" in analysis_results.selected_engines %}
                    <th>IP Quality Score</th>
                    {% endif %}
                    {% if "spur" in analysis_results.selected_engines %}
                    <th>Spur.us</th>
                    {% endif %}
                    {% if "virustotal" in analysis_results.selected_engines %}
                    <th>VirusTotal</th>
                    {% endif %}
                    {% if "mde" in analysis_results.selected_engines %}
                    <th>Microsoft Defender for Endpoint</th>
                    {% endif %}
                    {% if "google_safe_browsing" in analysis_results.selected_engines %}
                    <th>Google Safe Browsing</th>
                    {% endif %}
                    {% if "shodan" in analysis_results.selected_engines %}
                    <th>Shodan</th>
                    {% endif %}
                    {% if "phishtank" in analysis_results.selected_engines %}
                    <th>Phishtank</th>
                    {% endif %}
                    {% if "abusix" in analysis_results.selected_engines %}
                    <th>Abusix</th>
                    {% endif %}
                    {% if "rdap" in analysis_results.selected_engines %}
                    <th>RDAP</th>
                    {% endif %}
                    {% if "threatfox" in analysis_results.selected_engines %}
                    <th>ThreatFox</th>
                    {% endif %}
                    {% if "google" in analysis_results.selected_engines %}
                    <th>Google</th>
                    {% endif %}
                    {% if "github" in analysis_results.selected_engines %}
                    <th>Github</th>
                    {% endif %}
                    {% if "ioc_one_html" in analysis_results.selected_engines %}
                    <th>Ioc.One (HTML)</th>
                    {% endif %}
                    {% if "ioc_one_pdf" in analysis_results.selected_engines %}
                    <th>Ioc.One (PDF)</th>
                    {% endif %}
                </tr>
            </thead>
            <tbody>
                {% for result in analysis_results.results %}
                <tr
                    class="
                    {% if result.abuseipdb and result.abuseipdb.risk_score > 50 %}
                        high-risk
                    {% elif result.virustotal and (result.virustotal.total_malicious > 10 or result.virustotal.community_score < -10) %}
                        high-detection
                    {% elif result.virustotal and result.virustotal.community_score > 100 %}
                        clean-detection
                    {% elif result.spur and result.spur.tunnels not in ['Not anonymous', 'Non applicable'] %}
                        warning-row
                    {% elif result.ipquality_score and (result.ip_quality_score.proxy or result.ip_quality_score.vpn or result.ip_quality_score.tor) %}
                        warning-row
                    {% elif result.ipquery and (result.ipquery.is_proxy or result.ipquery.is_vpn or result.ipquery.is_tor) %}
                        warning-row
                    {% elif (result.ip_quality_score and result.ip_quality_score.fraud_score > 50) or (result.ipquery and result.ipquery.risk_score > 50) %}
                        high-risk
                    {% elif result.threatfox and result.threatfox.count != 0 %}
                        high-risk
                    {% endif %}
                    ">
                    <td>{{ result.observable }}</td>
                    <td>{{ result.type }}</td>
                    {% if "reverse_dns" in analysis_results.selected_engines %}
                    <td>
                        {% if result.reverse_dns %}
                        {% for dns in result.reverse_dns.reverse_dns %}
                            {{ dns }}<br>
                        {% endfor %}
                        {% else %}
                        Not applicable
                        {% endif %}
                    </td>
                    {% endif %}
                    {% if "ipquery" in analysis_results.selected_engines %}
                    <td>
                        {% if result.ipquery %}
                        <strong>IP: </strong><a href="{{ result.ipquery.link }}" target="_blank">{{ result.ipquery.ip }}</a><br>
                        <strong>Score: </strong><a href="{{ result.ipquery.link }}" target="_blank">{{ result.ipquery.risk_score }}</a><br>

                        <strong>Geoloc: </strong>{{ result.ipquery.geolocation }}<br>
                        <strong>Country: </strong><span class="country country-{{result.ipquery.country_name | lower}}">{{result.ipquery.country_name}}</span> <span class="fi fi-{{ result.ipquery.country_code | lower }}"></span><br>
                        <strong>ASN: </strong>{{ result.ipquery.asn }} {{ result.ipquery.isp }}<br>
                        {% if result.ipquery.is_proxy == True %}
                        <strong>Proxy: </strong>{{ result.ipquery.is_proxy }}<br>
                        {% endif %}

                        {% if result.ipquery.is_vpn == True %}
                        <strong>VPN: </strong>{{ result.ipquery.is_vpn }}<br>
                        {% endif %}
                        {% if result.ipquery.is_tor == True %}
                        <strong>Tor: </strong>{{ result.ipquery.is_tor }}<br>
                        {% endif %}
                        {% if result.ipquery.is_tor == False and result.ipquery.is_vpn == False and result.ipquery.is_proxy == False %}
                        <strong>Type: </strong>Not anonymous<br>
                        {% endif %}
                        {% else %}
                        Not applicable
                        {% endif %}
                    </td>
                    {% endif %}
                    {% if "ipinfo" in analysis_results.selected_engines %}
                    <td>
                        {% if result.ipinfo and result.reversed_success and result.type in ["URL", "FQDN"] %}
                        Reverse DNS applied<br>
                        {% endif %}
                        {% if result.ipinfo %}
                        <strong>IP: </strong><a href="{{ result.ipinfo.link }}" target="_blank">{{ result.ipinfo.ip }}</a><br>
                        <strong>Geoloc: </strong>{{ result.ipinfo.geolocation }}<br>
                        <strong>Country: </strong><span class="country country-{{result.ipinfo.country_name | lower}}">{{result.ipinfo.country_name}}</span> <span class="fi fi-{{ result.ipinfo.country_code | lower }}"></span><br>
                        <strong>Hostname: </strong>{{ result.ipinfo.hostname }}<br>
                        <strong>ASN: </strong>{{ result.ipinfo.asn }}
                        {% else %}
                        Not applicable
                        {% endif %}
                    </td>
                    {% endif %}
                    {% if "abuseipdb" in analysis_results.selected_engines %}
                    <td>
                        {% if result.abuseipdb and result.reversed_success and result.type in ["URL", "FQDN"] %}
                        Reverse DNS applied<br>
                        {% endif %}
                        {% if result.abuseipdb %}
                        <strong>Reports: </strong>
                        <a href="{{ result.abuseipdb.link }}" target="_blank">{{ result.abuseipdb.reports }}</a><br>
                        <strong>Risk: </strong>{{ result.abuseipdb.risk_score }}%<br>
                        {% else %}
                        Not applicable
                        {% endif %}
                    </td>
                    {% endif %}
                    {% if "ip_quality_score" in analysis_results.selected_engines %}
                    <td>
                        {% if result.ip_quality_score %}
                        <strong>Score: </strong><a href="{{ result.ip_quality_score.link }}" target="_blank">{{ result.ip_quality_score.fraud_score }}</a><br>
                        
                        {% if result.ip_quality_score.proxy == True %}
                        <strong>Proxy: </strong>{{ result.ip_quality_score.proxy }}<br>
                        {% endif %}

                        {% if result.ip_quality_score.vpn == True %}
                        <strong>VPN: </strong>{{ result.ip_quality_score.vpn }}<br>
                        {% endif %}
                        {% if result.ip_quality_score.tor == True %}
                        <strong>Tor: </strong>{{ result.ip_quality_score.tor }}<br>
                        {% endif %}
                        {% if result.ip_quality_score.tor == False and result.ip_quality_score.vpn == False and result.ip_quality_score.proxy == False %}
                        Not anonymous<br>
                        {% endif %}
                        <strong>ISP: </strong>{{ result.ip_quality_score.ISP }}<br>
                        <strong>Organization: </strong>{{ result.ip_quality_score.organization }}<br>
                        {% else %}
                        Not applicable
                        {% endif %}
                    </td>
                    {% endif %}
                    {% if "spur" in analysis_results.selected_engines %}
                    <td>
                        {% if result.spur and result.reversed_success and result.type in ["URL", "FQDN"] %}
                        Reverse DNS applied<br>
                        {% endif %}
                        {% if result.spur %}
                        <a href="{{ result.spur.link }}" target="_blank">{{ result.spur.tunnels }}</a><br>
                        {% else %}
                        Not applicable
                        {% endif %}
                    </td>
                    {% endif %}
                    {% if "virustotal" in analysis_results.selected_engines %}
                    <td>
                        {% if result.virustotal %}
                        <strong>Ratio: </strong>
                        <a href="{{ result.virustotal.link }}" target="_blank">{{ result.virustotal.detection_ratio
                            }}</a><br>
                        <strong>Community: </strong>{{ result.virustotal.community_score }}
                        {% else %}
                        Not applicable
                        {% endif %}
                    </td>
                    {% endif %}
                    {% if "mde" in analysis_results.selected_engines %}
                    <td>
                        {% if result.mde and result.mde.ipAddress %}
                        <strong>Devices: </strong><a href="{{ result.mde.link }}" target="_blank">{{ result.mde.orgPrevalence }}</a><br>
                        <strong>First seen: </strong>{{ result.mde.orgFirstSeen }} <br>
                        <strong>Last seen: </strong>{{ result.mde.orgLastSeen }} <br>
                        {% elif result.mde and result.mde.sha1 %}
                        <strong>Devices: </strong><a href="{{ result.mde.link }}" target="_blank">{{ result.mde.organizationPrevalence }}</a><br>
                        <strong>First seen: </strong>{{ result.mde.orgFirstSeen }} <br>
                        <strong>Last seen: </strong>{{ result.mde.orgLastSeen }} <br>
                        <strong>Top filenames: </strong>{{ result.mde.topFileNames }} <br>
                        <strong>File product name: </strong>{{ result.mde.fileProductName }} <br>
                        <strong>File publisher: </strong>{{ result.mde.filePublisher }} <br>
                        <strong>Signer : </strong>{{ result.mde.signer }} <br>
                        <strong>Issuer: </strong>{{ result.mde.issuer }} <br>
                        <strong>IsValidCertificate: </strong>{{ result.mde.isValidCertificate }} <br>
                        <strong>Determination: </strong>{{ result.mde.determinationType }} <br>
                        <strong>Determination value: </strong>{{ result.mde.determinationValue }}
                        {% elif result.mde and result.mde.host %}
                        </strong>Devices: </strong><a href="{{ result.mde.link }}" target="_blank">{{ result.mde.orgPrevalence }}</a><br>
                        </strong>First seen: </strong>{{ result.mde.orgFirstSeen }} <br>
                        </strong>Last seen: </strong>{{ result.mde.orgLastSeen }} <br>
                        {% else %}
                        Not applicable
                        {% endif %}
                    </td>
                    {% endif %}
                    {% if "google_safe_browsing" in analysis_results.selected_engines %}
                    <td>
                        {% if result.google_safe_browsing %}
                        <strong>Threat: </strong>{{ result.google_safe_browsing.threat_found }} <br>
                        <strong>Details: </strong>{{ result.google_safe_browsing.details }}
                        {% else %}
                        Not applicable
                        {% endif %}
                    </td>
                    {% endif %}
                    {% if "shodan" in analysis_results.selected_engines %}
                    <td>
                        {% if result.shodan %}
                        <strong>Ports:</strong><br>
                        <a href="{{ result.shodan.link }}" target="_blank">
                        {% for port in result.shodan.ports %}
                        {{ port }}<br>
                        {% endfor %}
                        </a>
                        {% elif result.shodan and result.shodan.tags %}
                        <strong>Tags: </strong>{{ result.shodan.tags }}<br>
                        {% else %}
                        Not applicable
                        {% endif %}
                    </td>
                    {% endif %}
                    {% if "phishtank" in analysis_results.selected_engines %}
                    <td>
                        {% if result.phishtank and result.phishtank.in_database == True and result.phishtank.valid == True and result.phishtank.verified == True %}
                        <a href="{{ result.phishtank.phish_detail_page }}" target="_blank">Found (valid and verified)</a>
                        {% elif result.phishtank and result.phishtank.in_database == True and result.phishtank.valid == False %}
                        <a href="{{ result.phishtank.phish_detail_page }}" target="_blank">Found (invalid)</a>
                        {% elif result.phishtank and result.phishtank.in_database == True and result.phishtank.verified == False %}
                        <a href="{{ result.phishtank.phish_detail_page }}" target="_blank">Found (not verified)</a>
                        {% elif result.phishtank and result.phishtank.in_database == False %}
                        Not Found
                        {% else %}
                        Not applicable
                        {% endif %}
                    </td>
                    {% endif %}
                    {% if "abusix" in analysis_results.selected_engines %}
                    <td>
                        {% if result.abusix %}
                        <strong>Abuse contact: </strong><a href="mailto:{{ result.abusix.abuse }}?subject=Report of abuse concerning {{ result.observable }}&body=Hello,%0D%0A%0D%0AOur team found out that your {{ result.type }} {{ result.observable }} does malicious activity.%0D%0A%0D%0APlease take actions.">{{ result.abusix.abuse }}</a>
                        {% else %}
                        Not applicable
                        {% endif %}
                    </td>
                    {% endif %}
                    {% if "rdap" in analysis_results.selected_engines %}
                    <td>
                        {% if result.rdap %}
                        <strong>Registrar: </strong><a href="{{ result.rdap.link }}" target="_blank">{{ result.rdap.registrar }}</a><br>
                        {% if result.rdap.abuse_contact and result.rdap.abuse_contact != "" %}
                        <strong>Abuse contact: </strong><a href="mailto:{{ result.rdap.abuse_contact }}?subject=Report of abuse concerning {{ result.observable }}&body=Hello,%0D%0A%0D%0AOur team found out that your {{ result.type }} {{ result.observable }} does malicious activity.%0D%0A%0D%0APlease take actions.">{{ result.rdap.abuse_contact }}</a><br>
                        {% endif %}
                        {% if result.rdap.registrant and result.rdap.registrant != "" %}
                        <strong>Registrant: </strong> {{ result.rdap.registrant }}<br>
                        {% endif %}
                        {% if result.rdap.organization and result.rdap.organization != "" %}
                        <strong>Organization: </strong>{{ result.rdap.organization }}<br>
                        {% endif %}
                        {% if result.rdap.registrant_email and result.rdap.registrant_email != "" %}
                        <strong>Registrant email: </strong><a href="mailto:{{ result.rdap.registrant_email }}?subject=Report of abuse concerning {{ result.observable }}&body=Hello,%0D%0A%0D%0AOur team found out that your {{ result.type }} {{ result.observable }} does malicious activity.%0D%0A%0D%0APlease take actions.">{{ result.rdap.registrant_email }}</a><br>
                        {% endif %}
                        <strong>Creation: </strong>{{ result.rdap.creation_date }}<br>
                        <strong>Expiration: </strong>{{ result.rdap.expiration_date }}<br>
                        <strong>Updated: </strong>{{ result.rdap.update_date }}<br>
                        <strong>Name servers: </strong><br>
                        {% for ns in result.rdap.name_servers %}
                        {{ ns }}<br>
                        {% endfor %}
                        {% else %}
                        Not applicable
                        {% endif %}
                    </td>
                    {% endif %}
                    {% if "threatfox" in analysis_results.selected_engines %}
                    <td>
                        {% if result.threatfox and result.threatfox.count != 0 %}
                        <strong>Count: </strong><a href="{{ result.threatfox.link }}" target="_blank" title="Might not be available in the website itself.">{{ result.threatfox.count }}</a><br>
                        <strong>Malware: </strong><br>
                        {% for malware in result.threatfox.malware_printable %}
                        {{ malware }}<br>
                        {% endfor %}
                        {% elif result.threatfox and result.threatfox.count == 0 %}
                        Not Found
                        {% else %}
                        Not applicable
                        {% endif %}
                    </td>
                    {% endif %}
                    {% if "google" in analysis_results.selected_engines %}
                    <td>
                        {% if result.google and result.google.results | length > 0 %}
                        <strong>Search results: </strong><br>
                        {% for search_result in result.google.results %}
                        <a href="{{ search_result.url }}" target="_blank" title="{{ search_result.description }}">{{ search_result.title }}</a><br>
                        {% endfor %}
                        {% elif result.google and result.google.results | length == 0 %}
                        Not Found
                        {% else %}
                        Not applicable
                        {% endif %}
                    </td>
                    {% endif %}
                    {% if "github" in analysis_results.selected_engines %}
                    <td>
                        {% if result.github and result.github.results | length > 0 %}
                        <strong>Search results: </strong><br>
                        {% for search_result in result.github.results %}
                        <a href="{{ search_result.url }}" target="_blank" title="{{ search_result.description }}">{{ search_result.title }}</a><br>
                        {% endfor %}
                        {% elif result.github and result.github.results | length == 0 %}
                        Not Found
                        {% else %}
                        Not applicable
                        {% endif %}
                    </td>
                    {% endif %}
                    {% if "ioc_one_html" in analysis_results.selected_engines %}
                    <td>
                        {% if result.ioc_one_html and result.ioc_one_html.results | length > 0 %}
                        <strong>Search results: </strong><a href="{{ result.ioc_one_html.link }}" target="_blank">See on Ioc.One</a><br>
                        ---<br>
                        {% for search_result in result.ioc_one_html.results %}
                        <a href="{{ search_result.source }}" target="_blank" title="{{ search_result.header }}">{{ search_result.title }}</a><br>
                        {% endfor %}
                        {% elif result.ioc_one_html and result.ioc_one_html.results | length == 0 %}
                        Not Found
                        {% else %}
                        Not applicable
                        {% endif %}
                    </td>
                    {% endif %}
                    {% if "ioc_one_pdf" in analysis_results.selected_engines %}
                    <td>
                        {% if result.ioc_one_pdf and result.ioc_one_pdf.results | length > 0 %}
                        <strong>Search results: </strong><a href="{{ result.ioc_one_pdf.link }}" target="_blank">See on Ioc.One</a><br>
                        ---<br>
                        {% for search_result in result.ioc_one_pdf.results %}
                        <a href="{{ search_result.source }}" target="_blank" title="{{ search_result.header }}">{{ search_result.title }}</a><br>
                        {% endfor %}
                        {% elif result.ioc_one_pdf and result.ioc_one_pdf.results | length == 0 %}
                        Not Found
                        {% else %}
                        Not applicable
                        {% endif %}
                    </td>
                    {% endif %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% endif %}
    </div>

</body>
<footer class="footer">
    <nav>
        <ul>
            <li><a href="/">Home</a></li>
            <li><a href="/history">History</a></li>
            <li><a href="/stats">Statistics</a></li>
            <li><a href="/about">About</a></li>
            <li><a href="https://github.com/stanfrbd/cyberbro" target="_blank">GitHub</a></li>
        </ul>
    </nav>
</footer>

</html>
<script>
    const moonIcon = "https://img.icons8.com/ios-filled/50/ffffff/moon-symbol.png";
    const sunIcon = "https://img.icons8.com/ios-filled/50/ffffff/sun.png";

    function filterTable() {
        const searchInput = document.getElementById("searchInput").value.toLowerCase();
        const countryFilter = document.getElementById("countryFilter").value.toLowerCase();
        const riskFilter = document.getElementById("riskFilter").value.toLowerCase();
        const detectionFilter = document.getElementById("detectionFilter").value.toLowerCase();
        const typeFilter = document.getElementById("typeFilter").value.toLowerCase();
        const proxyVpnFilter = document.getElementById("proxyVpnFilter").value.toLowerCase();
        const table = document.getElementById("resultsTable");
        const tr = table.getElementsByTagName("tr");

        for (let i = 1; i < tr.length; i++) {
            let td = tr[i].getElementsByTagName("td");
            let showRow = true;

            if (searchInput) {
                showRow = Array.from(td).some(cell => cell.innerText.toLowerCase().includes(searchInput));
            }

            if (showRow && countryFilter !== "all") {

                const countrySpan = tr[i].querySelector(".country");
                const country = countrySpan ? countrySpan.className.split("-")[1] : "";
                showRow = country === countryFilter;
            }

            if (showRow && riskFilter !== "all") {
                const riskClass = tr[i].classList.contains("high-risk") ? "high" : "low";
                showRow = riskClass === riskFilter;
            }

            if (showRow && detectionFilter !== "all") {
                const detectionClass = tr[i].classList.contains("high-detection") ? "high" : tr[i].classList.contains("clean-detection") ? "clean" : "low";
                showRow = detectionClass === detectionFilter;
            }

            if (showRow && typeFilter !== "all") {
                showRow = td[1].innerText.toLowerCase() === typeFilter;
            }

            // Spur or IP Quality Score
            if (showRow && proxyVpnFilter !== "all") {
                let anonymousResult = "";
                anonymousResult = tr[i].innerText.toLowerCase();
                showRow = anonymousResult.includes(proxyVpnFilter);
            }

            tr[i].style.display = showRow ? "" : "none";
        }
    }

    function clearFilters() {
        document.getElementById("searchInput").value = "";
        document.getElementById("countryFilter").value = "all";
        document.getElementById("riskFilter").value = "all";
        document.getElementById("detectionFilter").value = "all";
        document.getElementById("typeFilter").value = "all";
        document.getElementById("proxyVpnFilter").value = "all";
        filterTable();
    }

    function toggleDarkMode() {
        document.body.classList.toggle("dark-mode");
        localStorage.setItem("darkMode", document.body.classList.contains("dark-mode"));
        updateDarkModeIcon();
    }

    function updateDarkModeIcon() {
        const darkModeIcon = document.getElementById("darkModeIcon");
        if (document.body.classList.contains("dark-mode")) {
            darkModeIcon.src = sunIcon;
            darkModeIcon.alt = "Light Mode";
        } else {
            darkModeIcon.src = moonIcon;
            darkModeIcon.alt = "Dark Mode";
        }
    }

    function applyDarkMode() {
        if (localStorage.getItem("darkMode") === "true") {
            document.body.classList.add("dark-mode");
        }
        updateDarkModeIcon();
    }

    applyDarkMode();
</script>
